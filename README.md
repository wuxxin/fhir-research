# Python Medical Data Science Project

This project demonstrates the use of Python for handling and visualizing medical data, specifically focusing on FHIR resources, pandas for data analysis, and Bokeh for visualization. It includes utilities for creating example FHIR Patient and Observation (HDL Cholesterol) data, flattening FHIR bundles for analysis, and example notebooks in Marimo and Jupyter formats for visualization.

## Project Structure

```
.
├── notebooks/
│   ├── hdl_visualization.ipynb  # Jupyter notebook for HDL visualization
│   └── hdl_visualization.md     # Marimo notebook for HDL visualization
├── scripts/
│   └── generate_example_data.py # Script to generate example FHIR data and print DataFrame
├── src/
│   └── medical_data_science/
│       ├── __init__.py
│       └── fhir_utils.py        # Utility functions for FHIR data creation and flattening
├── pyproject.toml               # Project configuration and dependencies
└── uv.lock                      # Lock file for dependencies (to be generated by uv)
```

## Setup

This project uses `uv` for package management, as specified in `pyproject.toml`.

1.  **Install `uv`**:
    If you don't have `uv` installed, follow the instructions at [https://github.com/astral-sh/uv](https://github.com/astral-sh/uv).

2.  **Create a Virtual Environment and Install Dependencies**:
    Open your terminal in the project root directory and run:
    ```bash
    # Create a virtual environment (recommended)
    uv venv
    source .venv/bin/activate # On macOS/Linux
    # .venv\Scripts\activate # On Windows

    # Install dependencies from pyproject.toml
    uv pip sync
    ```

    **Important**: The `pyproject.toml` has been updated to include `pandas`, `fhir.resources`, `bokeh`, `marimo`, and `jupyterlab` in its `[project.dependencies]` section, which is necessary for `uv pip sync` to work.

## Running the Code

### 1. Generate Example Data Script

To run the script that generates example FHIR data and prints the flattened DataFrame to the console:

```bash
python scripts/generate_example_data.py
```
Make sure you are in the project root directory and your virtual environment is activated.

### 2. Jupyter Notebook

1.  Ensure JupyterLab or Jupyter Notebook is installed (as per setup).
2.  Launch JupyterLab/Notebook:
    ```bash
    jupyter lab
    # OR
    jupyter notebook
    ```
3.  Navigate to the `notebooks/` directory in the Jupyter interface and open `hdl_visualization.ipynb`.
4.  Run the cells in the notebook.

### 3. Marimo Notebook

1.  Ensure Marimo is installed (as per setup).
2.  Run the Marimo notebook:
    ```bash
    marimo edit notebooks/hdl_visualization.md
    ```
    (Or `marimo run notebooks/hdl_visualization.md` for run-only mode).
3.  This will open the notebook in your web browser.

## FHIR Profiles

*   **Patient Data**: Uses the core FHIR Patient resource.
    *   `Patient.name` conforms to `http://fhir.de/StructureDefinition/humanname-de-basis`.
    *   `Patient.address` conforms to `http://fhir.de/StructureDefinition/address-de-basis`.
*   **HDL Cholesterol Observation**: Uses the core FHIR Observation resource.
    *   Category: `laboratory`
    *   Code: LOINC `2085-9` ("Cholesterol in HDL [Mass/volume] in Serum or Plasma")
    *   Units: `mg/dL` (UCUM code `mg/dL`)
```
